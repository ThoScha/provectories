(this["webpackJsonppowerbi-embedded-sample"]=this["webpackJsonppowerbi-embedded-sample"]||[]).push([[0],{185:function(e,t,r){e.exports=r(388)},383:function(e,t,r){},388:function(e,t,r){"use strict";r.r(t),r.d(t,"USER",(function(){return z}));r(186),r(195),r(378);var n=r(14),a=r.n(n),c=r(179),o=r.n(c),s=r(3),i=r.n(s),u=r(13),p=r(81),l=r(82),f=r(184),d=r(181),h=r(391),v=r(34),m=(r(383),["https://analysis.windows.net/powerbi/api/Report.Read.All"]),b="0223b04f-f0a4-43c6-9dbe-e152236e6a5a",y="7c8477cc-60dc-4edf-a9f0-71b6f1b575da",k=r(83),x=r(114),g=r(180);function w(e,t,r){var n=Object(g.initProvenance)(t);n.done();var a=function(){var e=Object(u.a)(i.a.mark((function e(t){var r,a,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t();case 2:r=e.sent,a=r.newState,c=r.label,n.apply({apply:function(e){return{state:a,label:c,stateSaveMode:"Complete",actionType:"Regular",eventType:"",meta:{}}}},c);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return{provenance:n,actions:{event:a}}}r(178);function S(e){return j.apply(this,arguments)}function j(){return(j=Object(u.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.bookmarksManager.capture();case 3:return e.abrupt("return",e.sent);case 6:e.prev=6,e.t0=e.catch(0),console.error(e.t0);case 9:return e.abrupt("return",void 0);case 10:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}function O(e){return E.apply(this,arguments)}function E(){return(E=Object(u.a)(i.a.mark((function e(t){var r,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=0,n=null;case 2:if(!(r<4)){e.next=16;break}return e.prev=3,e.next=6,t.exportData(v.models.ExportDataType.Summarized);case 6:return n=e.sent,e.abrupt("break",16);case 10:e.prev=10,e.t0=e.catch(3),4===++r&&console.error("exportData - "+t.title,e.t0);case 14:e.next=2;break;case 16:return e.abrupt("return",n);case 17:case"end":return e.stop()}}),e,null,[[3,10]])})))).apply(this,arguments)}function R(e){return e.split(" ").map((function(e,t){return 0===t?e:e[0].toUpperCase()+e.slice(1)})).join("")}function T(e){return U.apply(this,arguments)}function U(){return(U=Object(u.a)(i.a.mark((function e(t){var r,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={},!t.getCapabilities){e.next=8;break}return e.next=4,t.getCapabilities();case 4:if(!(n=e.sent).dataRoles){e.next=8;break}return e.next=8,Promise.all(n.dataRoles.map(function(){var e=Object(u.a)(i.a.mark((function e(n){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getDataFields(n.name);case 2:if(!((a=e.sent).length>0)){e.next=6;break}return e.next=6,Promise.all(a.map(function(){var e=Object(u.a)(i.a.mark((function e(a,c){var o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getDataFieldDisplayName(n.name,c);case 2:o=e.sent,r[R(o)]=n.name;case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e){return C.apply(this,arguments)}function C(){return(C=Object(u.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",t.getPages().then(function(){var e=Object(u.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.filter((function(e){return e.isActive}))[0].getVisuals().then((function(e){return e.filter((function(e){return"card"!==e.type&&"shape"!==e.type}))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:return e.prev=4,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",[]);case 8:case"end":return e.stop()}}),e,null,[[0,4]])})))).apply(this,arguments)}var D={};function N(e){Object.keys(e).forEach((function(t){D[t]=e[t]}))}var P=function(){function e(t){Object(p.a)(this,e),this.appState=void 0,this.bookmark=void 0,this.report=void 0,this.appState={},this.bookmark={current:""},this.report=t,this.init()}return Object(l.a)(e,[{key:"setVisSelected",value:function(e){var t=e.detail.dataPoints,r=e.detail.visual,n=r.type,a=r.title,c=this.appState,o="".concat(a," (").concat(n,") - ");"slicer"!==n&&Object.keys(c).forEach((function(e){var t=c[e];t.selected="slicer"!==t.type?null:t.selected}));var s=c[R(a)];return t.length>0?(t[0].identity.forEach((function(e,t){s.selected=Object(x.a)(Object(x.a)({},s.selected),{},Object(k.a)({},e.target.column,e.equals.toString())),o+="".concat(t>0?", ":"").concat(e.target.column,": ").concat(e.equals)})),o+" selected"):(s.selected=null,o+"deselected")}},{key:"setVisState",value:function(){var e=Object(u.a)(i.a.mark((function e(t){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A(this.report);case 2:return r=e.sent,e.next=5,Promise.all(r.map(function(){var e=Object(u.a)(i.a.mark((function e(r){var n,a,c,o,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(r);case 2:return n=e.sent,e.next=5,T(r);case 5:if(a=e.sent,n){e.next=8;break}return e.abrupt("return");case 8:c=n.data.replaceAll("\n","").split("\r").map((function(e){return e.split(",")})).slice(0,-1),o={},c[0].forEach((function(e,t){var r=R(e);o[r]=[];var n=o[r],s=a[r];c.forEach((function(e,r){if(0!==r&&e[t]){var a=e[t],c=a.match(/\d+/),o=c&&"Y"===s?parseInt(c[0]):a;n.push(o)}}))})),s=t[R(r.title)].visState,Object.keys(o).forEach((function(e){var t=Array.from(o[e]);s[e]="number"===typeof t[0]?t.reduce((function(e,t){return e+t}),0):Array.from(new Set(t))}));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:return e.abrupt("return",t);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setBookmark",value:function(){var e=Object(u.a)(i.a.mark((function e(){var t=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S(this.report).then((function(e){var r=(null===e||void 0===e?void 0:e.state)||"";return t.bookmark.current=r,r}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initAppState",value:function(){var e=Object(u.a)(i.a.mark((function e(){var t=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A(this.report);case 2:e.sent.forEach((function(e){var r=R(e.title);t.appState&&!t.appState[r]&&(t.appState[R(r)]={selected:null,type:e.type,visState:{}})}));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=Object(u.a)(i.a.mark((function e(){var t,r,n,a,c,o,s=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initAppState();case 2:return e.next=4,this.setVisState(this.appState);case 4:return r=e.sent,e.next=7,this.setBookmark();case 7:return n=e.sent,a=w(this.report,{appState:r,bookmark:n},this.bookmark),c=a.actions,N(a.provenance),e.next=12,this.report.getActivePage();case 12:o=e.sent.name,null===(t=this.report)||void 0===t||t.on("dataSelected",function(){var e=Object(u.a)(i.a.mark((function e(t){var r,n,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=o,e.next=3,s.report.getActivePage();case 3:if(e.t1=e.sent.name,e.t0!==e.t1){e.next=13;break}return r=s.setVisSelected(t),e.next=8,s.setBookmark();case 8:n=e.sent,a=function(){var e=Object(u.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.setVisState("object"===typeof(a=s.appState)?JSON.parse(JSON.stringify(a)):a);case 2:return t=e.sent,console.log(t),e.abrupt("return",{newState:{bookmark:n,appState:t},label:r});case 5:case"end":return e.stop()}var a}),e)})));return function(){return e.apply(this,arguments)}}(),c.event(a),e.next=14;break;case 13:console.log("Not on the tracked page");case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();var I=r(182),q=r(183);function B(e){var t=e.report,r=e.forceUpdate,n=a.a.useState(null),c=Object(q.a)(n,2),o=c[0],s=c[1];t.off("rendered"),t.on("rendered",(function(){(null===D||void 0===D?void 0:D.root)&&!(null===o||void 0===o?void 0:o.root)&&(s(D),t.off("rendered"))}));var i=function(e){var t=e.root,r=e.graph,n=[];return Object.keys(r.nodes).forEach((function(a){var c=r.nodes[a],o=function(e,t){var r={};return Object.keys(t).forEach((function(n){var a=e[n],c=a.visState,o=a.selected,s=a.type,i=t[n].visState;Object.keys(i).forEach((function(e){var t=i[e],a=c[e],u=r[n+"."+e]=[];"number"===typeof t?u.push(a/t):t.forEach((function(t){u.push(o&&o[e]===t?1:0),"slicer"!==s&&u.push(a.includes(t)?0:1)}))}))})),r}(e.getState(c.id).appState,e.getState(t.id).appState);a===t.id&&n.push(["time","user","label"].concat(Object(I.a)(Object.keys(o))));var s=[c.metadata.createdOn||-1,z,c.label];n[0].forEach((function(e){return o[e]?s.push(o[e]):null})),n.push(s)})),n},u=function(e){var t=encodeURI(function(e){var t="data:text/csv;charset=utf-8,";return e.forEach((function(e,r){0===r?t+=e.join(";")+"\r\n":e.forEach((function(r,n){var a="string"===typeof r?r:JSON.stringify(r);a=a.replaceAll("[","").replaceAll("]",""),t+=a,t+=n<e.length-1?";":"\r\n"}))})),t}(i(e))),r=document.createElement("a");r.style.display="none","download"in r?(r.download="provectories-".concat(z,"-").concat((new Date).getTime(),".csv"),r.href=t,r.click()):window.open(t,"_self"),r.remove()};return a.a.createElement("div",{style:{marginLeft:"auto"}},o?a.a.createElement("div",{style:{marginRight:0}},a.a.createElement("button",{type:"button",className:"ui button",onClick:function(){return r()}},"Reset provenance"),a.a.createElement("button",{className:"ui button",type:"button",onClick:function(){return u(o)}},"Download as CSV")):null)}var V,F=new v.service.Service(v.factories.hpmFactory,v.factories.wpmpFactory,v.factories.routerFactory),J="",M="",L=function(e){Object(f.a)(r,e);var t=Object(d.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).myReport=void 0,n.state={accessToken:"",embedUrl:"",error:[],reportRef:a.a.createRef()},n.myReport=null,n}return Object(l.a)(r,[{key:"render",value:function(){return this.myReport=this.renderMyReport(),a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{style:{display:"flex",flexDirection:"column",margin:15}},a.a.createElement("div",{style:{display:"flex",flex:1}},a.a.createElement("div",{id:"reportContainer",ref:this.state.reportRef,style:{display:"flex",flex:1,marginBottom:5}},"Loading the report...")),this.myReport?a.a.createElement(B,{report:this.myReport,forceUpdate:this.forceUpdate.bind(this)}):null))}},{key:"componentDidMount",value:function(){var e=Object(u.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null!==this.state.reportRef&&(V=this.state.reportRef.current),this.authenticate();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renderMyReport",value:function(){var e=null;if(this.state.error.length)V.textContent="",this.state.error.forEach((function(e){V.appendChild(document.createTextNode(e)),V.appendChild(document.createElement("br"))})),console.log("Error",this.state.error);else if(""!==this.state.accessToken&&""!==this.state.embedUrl){var t={type:"report",tokenType:v.models.TokenType.Aad,accessToken:J,embedUrl:M,permissions:v.models.Permissions.All,id:y,settings:{visualRenderedEvents:!0,panes:{filters:{visible:!0},pageNavigation:{visible:!0}}}};(e=F.embed(V,t)).off("loaded"),e.on("loaded",(function(){console.log("Report load successful"),function(e){new P(e)}(e)})),e.off("error"),e.on("error",(function(e){var t=e.detail;console.error(t)}))}return e}},{key:"componentWillUnmount",value:function(){F.reset(V)}},{key:"authenticate",value:function(){var e=this,t=this,r={auth:{clientId:"f1f98e67-aeb3-406c-a3f6-8c90654a8562"}},n={scopes:m},a=new h.a(r);a.handleRedirectCallback((function(e){"id_token"===e.tokenType?t.authenticate():"access_token"===e.tokenType?(J=e.accessToken,t.setUsername(e.account.name),t.getembedUrl()):t.setState({error:["Token type is: "+e.tokenType]})}),(function(e){t.setState({error:["Redirect error: "+e]})})),a.getAccount()?a.acquireTokenSilent(n).then((function(t){J=t.accessToken,e.setUsername(t.account.name),e.getembedUrl()})).catch((function(e){"InteractionRequiredAuthError"===e.name?a.acquireTokenRedirect(n):t.setState({error:[e.toString()]})})):a.loginRedirect(n)}},{key:"getembedUrl",value:function(){var e=this;fetch("https://api.powerbi.com/v1.0/myorg/groups/"+b+"/reports/"+y,{headers:{Authorization:"Bearer "+J},method:"GET"}).then((function(t){var r=[];r.push("Error occurred while fetching the embed URL of the report"),r.push("Request Id: "+t.headers.get("requestId")),t.json().then((function(n){t.ok?(M=n.embedUrl,e.setState({accessToken:J,embedUrl:M})):(r.push("Error "+t.status+": "+n.error.code),e.setState({error:r}))})).catch((function(){r.push("Error "+t.status+":  An error has occurred"),e.setState({error:r})}))})).catch((function(t){e.setState({error:t})}))}},{key:"setUsername",value:function(e){var t=document.getElementById("welcome");null!==t&&(t.innerText="Welcome, "+e)}}]),r}(a.a.Component),_=r(392),z=Object(_.a)();console.log(z),o.a.render(a.a.createElement(L,null),document.getElementById("root"))}},[[185,1,2]]]);
//# sourceMappingURL=main.912d01d5.chunk.js.map